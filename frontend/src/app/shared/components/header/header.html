<header class="h-20 bg-white border-b border-gray-200 shadow-sm sticky top-0 z-20">
  <div class="flex items-center justify-between h-full px-6">

    <div class="flex items-center gap-5">
      <a [routerLink]="['/dashboard']" class="flex items-center gap-2">
        <img [src]="logoPath" alt="Library Logo" class="h-10 w-auto">
        <span class="text-2xl font-semibold text-red-900">BiblioAnGo</span>
      </a>
    </div>

    <div class="flex items-center gap-4 relative">

      <!-- Botón de Notificaciones -->
      <div class="relative">
        <button
          (click)="toggleNotificationMenu()"
          class="h-12 w-12 flex items-center justify-center rounded-full bg-red-900 text-white hover:bg-red-800 transition relative">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 14 20" xmlns="http://www.w3.org/2000/svg">
            <path d="M12.133 10.632v-1.8A5.406 5.406 0 0 0 7.979 3.57.946.946 0 0 0 8 3.464V1.1a1 1 0 0 0-2 0v2.364a.946.946 0 0 0 .021.106 5.406 5.406 0 0 0-4.154 5.262v1.8C1.867 13.018 0 13.614 0 14.807 0 15.4 0 16 .538 16h12.924C14 16 14 15.4 14 14.807c0-1.193-1.867-1.789-1.867-4.175ZM3.823 17a3.453 3.453 0 0 0 6.354 0H3.823Z"/>
          </svg>
          <!-- Indicador de notificaciones no leídas (solo si está loggeado) -->
          <span *ngIf="isLoggedIn" class="absolute top-1 right-1 h-3 w-3 bg-yellow-400 rounded-full border-2 border-white"></span>
        </button>

        <!-- Menú desplegable de notificaciones -->
        <div *ngIf="showNotificationMenu"
             class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl border border-gray-200 z-50">

          <!-- Si NO está loggeado -->
          <div *ngIf="!isLoggedIn" class="p-6 text-center">
            <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="currentColor" viewBox="0 0 14 20" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.133 10.632v-1.8A5.406 5.406 0 0 0 7.979 3.57.946.946 0 0 0 8 3.464V1.1a1 1 0 0 0-2 0v2.364a.946.946 0 0 0 .021.106 5.406 5.406 0 0 0-4.154 5.262v1.8C1.867 13.018 0 13.614 0 14.807 0 15.4 0 16 .538 16h12.924C14 16 14 15.4 14 14.807c0-1.193-1.867-1.789-1.867-4.175ZM3.823 17a3.453 3.453 0 0 0 6.354 0H3.823Z"/>
            </svg>
            <h3 class="text-lg font-semibold text-gray-800 mb-2">Inicia sesión para ver notificaciones</h3>
            <p class="text-gray-600 mb-4">Debes iniciar sesión para recibir y ver tus notificaciones</p>
            <button
              [routerLink]="['/login']"
              (click)="closeMenus()"
              class="w-full bg-red-900 text-white py-2 px-4 rounded-lg hover:bg-red-800 transition">
              Iniciar Sesión
            </button>
          </div>

          <!-- Si está loggeado -->
          <div *ngIf="isLoggedIn">
            <div class="p-4 border-b border-gray-200">
              <h3 class="text-lg font-semibold text-gray-800">Notificaciones</h3>
            </div>
            <div class="max-h-96 overflow-y-auto">
              <!-- Ejemplo de notificaciones -->
              <div class="p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition">
                <p class="text-sm text-gray-800 font-medium">Nueva historia publicada</p>
                <p class="text-xs text-gray-600 mt-1">Un autor que sigues publicó una nueva historia</p>
                <span class="text-xs text-gray-500 mt-2 inline-block">Hace 2 horas</span>
              </div>
              <div class="p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition">
                <p class="text-sm text-gray-800 font-medium">Nuevo comentario</p>
                <p class="text-xs text-gray-600 mt-1">Alguien comentó en tu historia</p>
                <span class="text-xs text-gray-500 mt-2 inline-block">Hace 5 horas</span>
              </div>
              <div class="p-4 hover:bg-gray-50 cursor-pointer transition">
                <p class="text-sm text-gray-800 font-medium">Nuevo seguidor</p>
                <p class="text-xs text-gray-600 mt-1">Tienes un nuevo seguidor</p>
                <span class="text-xs text-gray-500 mt-2 inline-block">Hace 1 día</span>
              </div>
            </div>
            <div class="p-3 border-t border-gray-200 text-center">
              <button class="text-sm text-red-900 hover:text-red-800 font-medium">
                Ver todas las notificaciones
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Botón de Perfil -->
      <div class="relative">
        <button
          (click)="toggleProfileMenu()"
          class="h-12 w-12 flex items-center justify-center rounded-full bg-red-900 text-white hover:bg-red-800 transition">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
          </svg>
        </button>

        <!-- Menú desplegable de perfil -->
        <div *ngIf="showProfileMenu && isLoggedIn"
             class="absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-xl border border-gray-200 z-50">

          <!-- Información del usuario -->
          <div class="p-4 border-b border-gray-200">
            <div class="flex items-center gap-3">
              <div class="h-12 w-12 rounded-full bg-red-900 flex items-center justify-center text-white font-bold text-lg">
                {{ userInfo?.nombre?.charAt(0).toUpperCase() || userInfo?.usuario?.charAt(0).toUpperCase() || 'U' }}
              </div>
              <div class="flex-1">
                <p class="font-semibold text-gray-800">{{ userInfo?.nombre || userInfo?.usuario || 'Usuario' }}</p>
                <p class="text-sm text-gray-600">{{ userInfo?.email || 'email@example.com' }}</p>
              </div>
            </div>
          </div>

          <!-- Opciones del menú -->
          <div class="py-2">
            <button
              (click)="goToProfile()"
              class="w-full px-4 py-3 text-left hover:bg-gray-50 transition flex items-center gap-3">
              <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
              <span class="text-gray-800">Mi Perfil</span>
            </button>

            <a
              [routerLink]="['/stories']"
              (click)="closeMenus()"
              class="w-full px-4 py-3 text-left hover:bg-gray-50 transition flex items-center gap-3 ">
              <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
              </svg>
              <span class="text-gray-800">Mis Historias</span>
            </a>

            <a
              [routerLink]="['/favorites']"
              (click)="closeMenus()"
              class="w-full px-4 py-3 text-left hover:bg-gray-50 transition flex items-center gap-3 ">
              <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
              <span class="text-gray-800">Favoritos</span>
            </a>
          </div>

          <!-- Cerrar sesión -->
          <div class="border-t border-gray-200 p-2">
            <button
              (click)="logout()"
              class="w-full px-4 py-3 text-left hover:bg-red-50 transition flex items-center gap-3 text-red-900">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
              </svg>
              <span class="font-medium">Cerrar Sesión</span>
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>
</header>

<!-- Overlay para cerrar menús al hacer clic fuera -->
<div
  *ngIf="showProfileMenu || showNotificationMenu"
  (click)="closeMenus()"
  class="fixed inset-0 z-10">
</div>
